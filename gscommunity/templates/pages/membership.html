{% extends "templates/baseweb.html" %} {% block content %}
<div class="container cont1" style="">
    <div class="row" style="text-align: center;background-color:#a88992;color:#fff;margin-left: 0px;margin-right: 5px;">
        <h3 style="color:#fff;margin-bottom: 12px;">GSOD Membership</h3>
    </div>
    <div class="col-md-8 col-sm-7 texta">
        <form id="validatemember">
            <!-- Modal content-->
            <div class="new">
                <div style="text-align: center;margin-top: 30px;">
                    <h4>Become A Member</h4>
                </div>
                <div class="" style="padding: 25px;margin-top: 25px">
                    <div class="row">
                        <div class="col-md-3 col-sm-3"></div>
                        <div class="col-md-6 col-sm-6">
                            <div class="form-group">
                                <label for="FullName">First Name <span style="color:red">*</span></label>
                                <input type="text" class="form-control" id="Full_Name" required="">
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 col-sm-3"></div>
                        <div class="col-md-6 col-sm-6">
                            <div class="form-group">
                                <label for="LastName">Last Name <span style="color:red">*</span></label>
                                <input type="text" class="form-control" id="Last_Name" required="">
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 col-sm-3"></div>
                        <div class="col-md-6 col-sm-6">
                            <div class="form-group">
                                <label for="email_id">Email <span style="color:red">*</span></label>
                                <input type="Email" class="form-control" id="email_id" required="">
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 col-sm-3"></div>
                        <div class="col-md-6 col-sm-6">
                            <div class="form-group">
                                <label for="phone_no">Mobile Number <span style="color:red">*</span></label>
                                <input type="text" class="form-control" id="phone_no" maxlength="10" required="">
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3"></div>
                        <div class="col-md-6 col-sm-12">
                            <div id="recapchaWidget" class="g-recaptcha"></div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <!--  <li>{{  frappe.get_doc('User', phone_no)}}</li> -->
                </div>
                <div class="submit_btn">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <div class="col-md-4 col-sm-5" style="">
        <div class="textb" style="height: 646px;">
            <div class="">
                <div style="text-align: center;margin-top: 30px;">
                    <h4>Membership Registration Help</h4>
                </div>
                <div style="padding: 25px;font-size: 17px;">
                    <p><i class="fa fa-angle-right" aria-hidden="true"></i><span style="color:red;"> Step1:</span> Provide basic information</p>
                    <p><i class="fa fa-angle-right" aria-hidden="true"></i><span style="color:red;"> Step2:</span> Verify Email</p>
                    <p><i class="fa fa-angle-right" aria-hidden="true"></i><span style="color:red;"> Step3:</span> Submit Membership type and Personal information</p>
                    <p><i class="fa fa-angle-right" aria-hidden="true"></i><span style="color:red;"> Step4:</span> Make a payment</p>
                </div>
            </div>
        </div>
    </div>
</div>
<style type="text/css">
p {
    margin: 10px 0 6px;
}

p+p {
    margin-top: 12px;
}

.reg_toggle {
    margin-top: 12%;
    text-align: center;
}

.reg_toggle li a {
    padding: 10px 15px;
    border-right: none;
}

.reg_toggle li {
    background: #ccc;
}

.reg_toggle li a:hover {
    color: #fff;
}

.reg_toggle li.active {
    background: #674b53;
}

.reg_toggle li.active a {
    color: #fff;
}

.submit_btn {
    margin-left: 27%;
    margin-bottom: 3%;
}

.form-control {
    padding: 6px 22px 11px;
}

.tab-content {
    margin-top: 15px;
    margin-bottom: 15px;
}

.tab-pane {
    border: 1px solid #ccc;
}

.textb {

    margin-top: 25px;

    border-color: rgb(225, 200, 200);
    border-style: solid;
    border-right-width: 1px;
    border-left-width: 1px;
    border-top-width: 1px;
    border-bottom-width: 1px;
    margin-right: -10px;
    padding-left: 10px;
    padding-right: 10px;
}

.textc {
    height: 293px;
    margin-top: 25px;
    border-color: rgb(225, 200, 200);
    border-style: solid;
    border-right-width: 1px;
    border-left-width: 1px;
    border-top-width: 1px;
    border-bottom-width: 1px;
    margin-right: -10px;
}

.texta {
    margin-top: 25px;
    border-color: rgb(225, 200, 200);
    border-style: solid;
    border-right-width: 1px;
    border-left-width: 1px;
    border-top-width: 1px;
    border-bottom-width: 1px;
    margin-bottom: 25px;
}

.table tbody td {
    padding: 15px !important;
}

.table>thead>tr>th {
    padding: 12px 10px;
}

th,
td {
    text-align: left !important;
}

.table-bordered>thead>tr>th,
.table-bordered>tbody>tr>th,
.table-bordered>tfoot>tr>th,
.table-bordered>thead>tr>td,
.table-bordered>tbody>tr>td,
.table-bordered>tfoot>tr>td {
    border: 1px solid #ccc;
}

.table>caption+thead>tr:first-child>th,
.table>colgroup+thead>tr:first-child>th,
.table>thead:first-child>tr:first-child>th,
.table>caption+thead>tr:first-child>td,
.table>colgroup+thead>tr:first-child>td,
.table>thead:first-child>tr:first-child>td {
    border: 1px solid #ccc;
}

.color1 {
    color: green;
}

.color2 {
    color: red;
}
.cont1{
    margin-top:165px;
    margin-bottom:35px;
}
@media screen and (max-width: 1024px) and (min-width: 768px){
    .cont1{
        margin-top: 190px;
    }
}
</style>
{% endblock %} {% block script %}
<script type="text/javascript">
$(document).ready(function() {

});

var widId = "";
var onloadCallback = function() {

    localStorage.setItem("recapt", 0);
    widId = grecaptcha.render('recapchaWidget', {
        'sitekey': '6Lc7MWEUAAAAAF88zZuXAm2FZSnDPhTc364xnHJD'
    });

};

function IsRecapchaValid() {
    var res = grecaptcha.getResponse(widId);
    if (res == "" || res == undefined || res.length == 0) {

        return false;
    } else {

    }
    return true;
}
</script>
<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
<script type="text/javascript">
$('#membergrid').hide();

$('#Full_Name').change(function(e) {
    var news = $('#Full_Name').val();
    if (!/^[a-zA-Z\s]*$/g.test(news)) {
        // alert("please enter characters only");
        return false;
    }
});

$('#Last_Name').change(function(e) {
    var news = $('#Last_Name').val();
    if (!/^[a-zA-Z\s]*$/g.test(news)) {

        frappe.msgprint("please enter characters only")
        return false;
    }

});
$('#phone_no').change(function(e) {
    var number = $('#phone_no').val();
    if (!validate_number(number)) {
        alert('Please enter a valid phone number')
        $('#phone_no').val('');
    }
    if (number.length != 10) {
        alert('Please enter 10 digit phone number')
        $('#phone_no').val('');
    }
});


$("#validatemember").submit(function(e) {
    var sam = localStorage.getItem("recapt");
    var sams = $("#g-recaptcha-response").val();
    // var sam=$('span[id="recaptcha-anchor"]').getAttribute("aria-checked");

    if (sams != "") {
        e.preventDefault();
        frappe.call({
            method: "gscommunity.gscommunity.api.create_user_detail",
            args: {
                "first_name": $("#Full_Name").val(),
                "last_name": $("#Last_Name").val(),
                "email": $("#email_id").val(),
                "mobile_no": $("#phone_no").val()
            },
            callback: function(r) {

                console.log(r.message)
                if (r.message) {
                    frappe.msgprint("Mail will send to your registered mail id.Please login to continue member registration.")
                    setTimeout(function() {

                        window.location.href = "/login#login";
                    }, 6000);

                }

            }
        });
    } else {
        frappe.msgprint("Please click the reCAPTCHA checkbox")
    }



})

$('#phones_no').change(function(e) {
    var d = $("#phones_no").val();
    if (d == "") {
        $('#membergrid').hide();
    }
})

$("#validateexistingmember").submit(function(e) {
    // window.location.href = "/membership-registration?new=1";
    e.preventDefault();

    frappe.call({
        method: "gscommunity.gscommunity.api.validate_existingmembers",
        args: {
            "mobile_no": $("#phones_no").val()
        },
        callback: function(r) {
            console.log(r.message)
            if (r.message) {
                var t = r.message[0]
                console.log(t)
                if (t) {
                    $('#membergrid').show();

                    var newval = new Array(t.member_name.length - 3).join('*') + t.member_name.substr(t.member_name.length - 4, 4);
                    var newmobile = new Array(t.phone_no.length - 3).join('*') + t.phone_no.substr(t.phone_no.length - 4, 4);
                    $('#mem_id').text(t.name);
                    $('#mem_name').text(t.member_name);
                    $('#mobile').text(newmobile);
                    var expir_date = t.membership_expiry_date;
                    var today = new Date();
                    var fdate = formatDate(today);
                    console.log(expir_date)
                    console.log(fdate)
                    if (expir_date > fdate && t.active == 1) {
                        // $('#renews').show();
                        $('#renews').css({ "display": "block" });
                    } else if (expir_date == "" && t.active == 1) {
                        $('#renews').css({ "display": "none" });
                    } else {
                        $('#renews').css({ "display": "none" });
                    }

                    if (t.active == 1) {
                        $('#state').addClass('color1');
                        $('#state').text("Active");
                    } else {
                        $('#state').addClass('color2');
                        $('#state').text("Inactive");
                    }
                }
            } else {
                frappe.msgprint("Member is not registered!")
                $('#membergrid').hide();
            }
        }
    });

})


function getchecked() {
    localStorage.setItem("recapt", 1);

}

function formatDate(date) {
    var year = date.getFullYear().toString();
    var month = (date.getMonth() + 101).toString().substring(1);
    var day = (date.getDate() + 100).toString().substring(1);
    return year + "-" + month + "-" + day;
}

function sendmail_password() {
    var member = $('#mem_id').text();
    console.log(member)
    frappe.call({
        method: "gscommunity.gscommunity.api.get_existinguser",
        args: {
            "member": member
        },
        callback: function(r) {
            var umail = r.message[0].email
            console.log(r.message)
            frappe.call({
                method: "frappe.core.doctype.user.user.reset_password",
                args: {
                    "user": umail
                },
                callback: function(r) {
                    console.log(r.message)

                }

            });
        }

    });

}
</script>
{% endblock %}
<!-- <input id="account" value="1234567899876543" />

<input id="account_changed" />

var account = document.getElementById('account');
var changed = document.getElementById('account_changed');

changed.value = new Array(account.value.length-3).join('x') + account.value.substr(account.value.length-4, 4); -->